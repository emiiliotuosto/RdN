We give semantics to global types using \emph{partially-ordered multi-set}.
%
Following~\cite{gaifman1987partial}, a \emph{pomsets} is an
isomorphism class of labelled partially-ordered sets (lposet), where
fixed a set of labels $\lset$,
\begin{itemize}
\item an lposet is a triple $(\eset, \leq, \alf)$, with $\eset$ a set
  of events, $\leq$ is a partial order on $\eset$, and
  $\alf: \eset \rightarrow \lset$ a labelling function mapping events
  in $\eset$ to labels in $\lset$;
\item two lposets $(\eset, \leq, \alf)$ and $(\eset', \leq', \alf')$
  are \emph{isomorphic} if there is a bijection
  $\phi: \eset \rightarrow \eset'$ such that
  $\ae \leq \ae' \iff \phi(\ae) \leq' \phi(\ae')$ and
  $\alf = \alf' \circ \phi$.
\end{itemize}
%
Intuitively, $\leq$ represents causality; for $\ae \neq \ae'$, if
$\ae \leq \ae'$ and both events occur then $\ae'$ is caused by $\ae$.
%
Note that $\alf$ is not required to be injective: for
$\ae \neq \ae' \in \eset$, $\alf(\ae) = \alf(\ae')$ means that $\ae$
and $\ae'$ model different occurrences of the same action.
%
In the following, $[\eset, \leq, \alf]$ denotes the isomorphism class
of $(\eset, \leq, \alf)$, symbols $\apom,\apom', \dots$ (resp.
$\aR, \aR', \dots$) range over (resp. sets of) pomsets, and we assume
that pomsets $\apom$ contain at least one lposet which will possibly
be referred to as $(\esetof \apom$, $\leqof \apom, \alfof \apom)$.
%
The empty pomset is denoted as $\emptypom$.

\eMnote{forse non serve}{\color{red}
An event $\ae$ is an \emph{immediate predecessor} of an event $\ae'$
(or equivalently $\ae'$ is an \emph{immediate successor} of $\ae$) in
a pomset $\apom$ if $\ae \neq \ae'$, $\ae \leqof \apom \ae'$, and for
all $\ae'' \in \esetof \apom$ such that
$\ae \leqof \apom \ae'' \leqof \apom \ae'$ either $\ae = \ae''$ or
$\ae' = \ae''$.
}
%
\todo{add graphical representation of pomsets}

Given an uncoordinated prefix $\apref$, we let $\pomsetsingle$ to be
the poset with a single event labelled by $\apref$.
%
We will use the auxiliary operations on pomsets described in the
following.

We define the union and the sequential composition of two pomsets
$\apom$ and $\apom'$ respectively as
\[
  \apom \pomsetcup \apom' =
  [\esetof{\apom} \uplus \esetof{\apom'},
  \leqof{\apom} \uplus \leqof{\apom'},
  \alfof{\apom} \uplus \alfof{\apom'}]
  \quad\text{and}\quad
  \rseq[\apom][\apom'] = 
  [\esetof{\apom} \uplus \esetof{\apom'},
  \leq,
  \alfof{\apom} \uplus \alfof{\apom'}]
\]
where
$\leq = \leqof{\apom} \uplus \leqof{\apom'} \cup \{(\ae,\ae') \sst \ae
\in \max \apom \land \ae' \in \min \apom' \land \roleof{\alfof{\apom}(\ae)} = \roleof{\alfof{\apom'}(\ae')}\}$.
%
Finally, for $h \geq 1$ and a pomset $\apom$ we define
\[
  \apom^h =
  \begin{cases}
    r & \text{if } h = 1
    \\
    r \pomsetcup r^{h-1} & \text{if } h > 1
  \end{cases}
\]

The semantics of a global type builds upon \emph{basic pomsets} $\bp$
of prefixes $\apref$; in fact, the semantics of a global type is build
by taking sets of disjoint unions of basic pomsets of prefixes
sequentially composed together.
%
Let $\arole,\arole' \in \multiroles$ and $h \geq 0$

\begin{align*}
  \bp =
  &
    \begin{cases}
      \pomsetrep{\node {$\apref$}}[],
      & \text{if $\apref$ uncoordinated } \land \roleof \in \participants \cup \multiroles^\unknownop
      \\
      \bigcup_{h \geq 1}\big(\pomsetrep{\node {$\apref$}}[])^h,
      & \text{if $\apref$ uncoordinated } \land \roleof \not\in \participants \cup \multiroles^\unknownop
    \end{cases}
  \\
  \bp[@][{\apref[\arole][\arole'][@][@][.]}] =
  &
    \begin{cases}
      \pomsetrep{
        \node (out) {$\apref[\arole][][@][@][.]$};
        \node[below = of out] (in) {$\apref[][\arole'][@][@][.]$};
        \draw[->] (out) -- (in);
      }[], & \text{if } \arole' \in \participants \cup \multiroles^\unknownop
      \\
      \pomsetrep{
        \node (out) {$\apref[\arole][]$};
        \node[below left = of out] (rd1) {$\ae_1$};
        \node[below = of out] (dots) {};
        \node[below right = of out] (rd2) {$\ae_h$};
        \draw[->] (out) -- (rd1);
        \draw[->] (out) -- (rd2);
        \draw[dotted] (rd1) -- (rd2);
      }[(\ae_i \mapsto {\apref[][\arole'][@][@][.]})_{1 \leq i \leq h}][][node distance = 1cm and .25cm], & \text{otherwise}
    \end{cases}
  \\
  \bp[@][{\apref[\arole][\arole']}] =
  &
    \pomsetrep{
    \node (out) {$\apref[\arole][]$};
    \node[below left = of out] (rd1) {$\ae_1$};
    \node[below = of out] (dots) {};
    \node[below right = of out] (rd2) {$\ae_h$};
    \node[below = of dots] (in) {$\apref[][\arole']$};
    \draw[->] (out) -- (rd1);
    \draw[->] (out) -- (rd2);
    \draw[->] (rd1) -- (in);
    \draw[->] (rd2) -- (in);
    \draw[dotted] (rd1) -- (rd2);
    }[(\ae_i \mapsto {\apref[][\arole'][@][@][.]})_{1 \leq i \leq h}][][node distance = 1cm and .25cm]
\end{align*}

\begin{align*}
  \ksem{\apref} =
  &
    \bigcup_{h \geq 1}\big(\bp[@][\apref]\big)^h,
  \qquad \text{if $\apref$ uncoordinated}
  \\
  \ksem{\apref[\arole][\arole'][@][@][.]} =
  &
    \begin{cases}
      \bigcup_{h \geq 1}\bp[@][{\apref[\arole][\arole'][@][@][.]}],
      & \text{if } \arole \in \participants % \land \arole' \in \participants \cup \multiroles^\unknownop
      \\
      \bigcup_{k \geq 1}\bigcup_{h \geq 1}\big(\bp[@][{\apref[\arole][\arole'][@][@][.]}]\big)^k,
      & \text{if } \arole \not\in \participants % \land \arole' \in \participants \cup \multiroles^\unknownop
    \end{cases}
  \\
  \ksem{\apref[\arole][\arole']} =
  &
    \begin{cases}
      \bigcup_{h \geq 1}\bp[@][{\apref[\arole][\arole']}],
      & \text{if } \arole \in \participants % \land \arole' \in \participants \cup \multiroles^\unknownop
      \\
      \bigcup_{k \geq 1}\bigcup_{h \geq 1}\big(\bp[@][{\apref[\arole][\arole']}]\big)^k,
      & \text{if } \arole \not\in \participants % \land \arole' \in \participants \cup \multiroles^\unknownop
    \end{cases}
  \\
  \ksem{\nil} = & \{ \emptypom \}
  \\
  \ksem \asum = & \bigcup_{\apom \in \ksem{\apref_i},\apom' \in \ksem{\aK_i}} \rseq[\apom][\apom']
\end{align*}
The semantics of $\arec$ is the union of the semantics of all
unfoldings of $\arec$.




%%% Local Variables:
%%% mode: latex
%%% TeX-master: "main"
%%% End:
